---


- name: add epel key
  shell: rpm --import https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7

- name: add epel
  yum_repository:
    name: epel
    description: EPEL YUM repo
    baseurl: https://download.fedoraproject.org/pub/epel/$releasever/$basearch/

#Commenting this out until error has been rectified. Error message:
#"This module requires NetworkManager glib API"
# - name: autoconnect eth1
#   nmcli:
#       conn_name: eth1
#       ifname: eth1
#       type: ethernet
#       state: present
#       autoconnect: yes
#       #ignore_errors: true

#   tags:
#      - nic

- name: TEMP WORKAROUND / update eth1 to ONBOOT=yes
  shell: sudo sed -i s/ONBOOT=no/ONBOOT=yes/g /etc/sysconfig/network-scripts/ifcfg-eth1
  when: ansible_distribution == 'CentOS'
  tags:
     - nic

- name: restart network service to initialize eth1
  service: name=network state=restarted
  when: ansible_distribution == 'CentOS'
  ignore_errors: true
  tags:
     - network

- name: yum update
  yum: name=* state=latest
  
- name: disable iptables
  service: name=iptables state=stopped enabled=no
  when: ansible_distribution == 'CentOS'
  ignore_errors: true

- name: disable ip6tables
  service: name=ip6tables state=stopped enabled=no
  when: ansible_distribution == 'CentOS'
  ignore_errors: true

- name: disable firewalld
  service: name=firewalld state=stopped enabled=no
  when: ansible_distribution == 'CentOS'
  ignore_errors: true

- name: install prereq packages (epel-release,tar,xz,zip,unzip,curl,ipset)
  yum: name=epel-release,tar,xz,zip,unzip,curl,ipset,bzip2 state=present
  ignore_errors: true

- name: install utility packages (traceroute, wget, mlocate, net-tools,bind-utils)
  yum: name=traceroute,wget,mlocate,tcpdump,net-tools,bind-utils state=present
  ignore_errors: true

- name: update SElinux
  shell: sudo sed -i s/SELINUX=enforcing/SELINUX=permissive/g /etc/selinux/config
  when: ansible_distribution == 'CentOS'

- name: setenforce 0
  shell: setenforce 0
  when: ansible_distribution == 'CentOS'

- name: enable passwordless sudo access
  #shell: echo '%wheel        ALL=(ALL)       NOPASSWD\: ALL' > /etc/sudoers
  lineinfile: "dest=/etc/sudoers state=present regexp='^%wheel' line='%wheel ALL=(ALL) NOPASSWD: ALL'"
  when: ansible_distribution == 'CentOS'


# - name: Install docker from Internet
#   shell: curl -fsSL https://get.docker.com/ | sh
  #yum: name=docker state=present

# - name: Reload systemctl after updating Docker service.
#   command: systemctl daemon-reload

# - name: start and enable docker service.
#   service: name=docker state=started enabled=yes